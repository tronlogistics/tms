{% extends "layout.html" %}

{% block content %}
<form name="create" action="" role="form" class="smart-wizard form-horizontal" id="form" method="post">
	{{ form.hidden_tag() }}
	<div id="form-container">
		<!-- start: PAGE CONTENT -->
			<div class="row">
				<div class="col-sm-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="fa fa-external-link-square"></i>
							Shipper
						</div>
						<div class="panel-body">
							<div class="col-sm-10">
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Company Name
									</label>
									<div class="col-sm-7">
										{{ form.shipper.company_name(class="form-control", placeholder="Company Name") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Phone
									</label>
									<div class="col-sm-7">
										{{ form.shipper.phone(class="form-control", placeholder="Phone") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Email
									</label>
									<div class="col-sm-7">
										{{ form.shipper.email(class="form-control", placeholder="Email") }}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="fa fa-external-link-square"></i>
							Broker
						</div>
						<div class="panel-body">
							<div class="col-sm-10">
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Company Name
									</label>
									<div class="col-sm-7">
										{{ form.broker.company_name(class="form-control", placeholder="Company Name") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Phone
									</label>
									<div class="col-sm-7">
										{{ form.broker.phone(class="form-control", placeholder="Phone") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-4 control-label">
										Email
									</label>
									<div class="col-sm-7">
										{{ form.broker.email(class="form-control", placeholder="Email") }}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="fa fa-external-link-square"></i>
							General
						</div>
						<div class="panel-body">
							<div class="col-sm-10">
								<div class="form-group">
									<label class="col-sm-3 control-label">
										Load Type <span class="symbol required"></span>
									</label>
									<div class="col-sm-7">
										{{ form.load_type(class="form-control") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">
										Required Trailer <span class="symbol required"></span>
									</label>
									<div class="col-sm-7">
										{{ form.trailer_type(class="form-control") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">
										Total Miles <span class="symbol required"></span>
									</label>
									<div class="col-sm-7">
										{{ form.total_miles(class="form-control", placeholder="Total Miles") }}
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label">
										Cost <span class="symbol required"></span>
									</label>
									<div class="col-sm-7">
										{{ form.price(class="form-control", placeholder="Price") }}
									</div>
								</div>
								<hr>
								<div class="form-group">
									<label class="col-sm-3 control-label">
										Load Description
									</label>
									<div class="col-sm-7">
										{{ form.description(class="autosize form-control", style="overflow: none; word-wrap: break-word; resize: horizontal; height: 69px;") }}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="fa fa-external-link-square"></i>
							Locations
						</div>
						<div class="panel-body">
							<div class="row">
								<div class="col-md-12 space20">
									<a href="#responsive-1" data-toggle="modal" class="new-modal btn btn-green">
												Add New <i class="fa fa-plus"></i>
											</a>
								</div>
							</div>
							<div class="table-responsive">
								<table class="table table-striped table-hover" id="sample_2">
									<thead>
										<tr>
											<th>Stop #</th>
											<th>Street Address</th>
											<th>City</th>
											<th>State</th>
											<th>Zip</th>
											<th>Arrival Date</th>
											{#<th>Arrival Time</th>#}
											<th>Delete</th>
										</tr>
									</thead>
									<tbody>
										<!--- Content created by table-data.js -->
									</tbody>
								</table>
							</div>
						</div>
					</div>

				</div>
				<hr>
				<div class="form-group">
					<div class="col-sm-2 col-sm-offset-3">
						<button class="btn btn-light-grey back-step btn-block">
							<i class="fa fa-circle-arrow-left"></i> Back
						</button>
					</div>
					<div class="col-sm-2 col-sm-offset-3">
						<button type="submit" class="btn btn-success btn-block">
							Finish <i class="fa fa-arrow-circle-right"></i>
						</button>
					</div>
				</div>
			</div>
		</div>

</form>
		<!-- end: RIGHT SIDEBAR -->
		{% include "partials/main_javascripts.html" %}
		<!-- start: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
		<script src="{{ static('backend/plugins/jquery-inputlimiter/jquery.inputlimiter.1.3.1.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery-validation/dist/jquery.validate.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jQuery-Smart-Wizard/js/jquery.smartWizard.js') }}"></script>
		<script src="{{ static('backend/js/form-wizard.js') }}"></script>
		<script src="{{ static('backend/plugins/autosize/jquery.autosize.min.js') }}"></script>
		<script src="{{ static('backend/plugins/select2/select2.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery.maskedinput/src/jquery.maskedinput.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery-maskmoney/jquery.maskMoney.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-modal/js/bootstrap-modal.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-modal/js/bootstrap-modalmanager.js') }}"></script>
		<script src="{{ static('backend/js/ui-modals.js') }}"></script>
		
		<script>
			$(document).ready(function(){
			    $(".new-modal").click(function(){
			    	create_modal($('.modal.fade').length + 1);  
			    }); 	
			    $('#sample_2').on('click', '.delete-row', function(event) {
			    	event.preventDefault();

			    	//Get ID of the modal being deleted
					modal_id = $(this).closest('tr').children('td:first').text();

					//Update modal to indicate value was deleted
					$('#locations-' + modal_id + '-retired').val("True");

					//Get stop number being removed
					stop_number = $(this).closest('tr').find(".stop-number").val()
					//Update stop #
					$('.stop-number').each(function(){
						if($(this).val() > stop_number) {
							$(this).val($(this).val() - 1);
						}
					});
					
					var tr = $(this).closest("tr");
					$('#sample_2').dataTable().fnDeleteRow(tr.index());
				});
				$( document ).on('click', '.edit-modal', function(e) {
					modal_id = $(this).closest('tr').children('td:first').text();
					$('#responsive-' + $.trim(modal_id)).find('.save-modal').text("Update");
					$('#responsive-' + $.trim(modal_id)).find('.save-modal').addClass("update-modal");
					$('#responsive-' + $.trim(modal_id)).find('.update-modal').removeClass("save-modal");
					//alert(table.row( this ).data());
				});
			});

			$( document ).on( "focus", "input.date-picker", function() {
				$('.date-picker').datepicker({
			            autoclose: true,
			            format: "mm/dd/yyyy",
						minDate: 0
			        });
			});

			$( document ).on( "click", ".save-modal", function() {
				
				var count = $('#sample_2').dataTable().fnSettings().aoData.length + 1;
				$('#sample_2').dataTable().fnAddData( [
		         	'<input type=\"text\" id=\"locations-' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '-stop_number\" name=\"locations-' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '-stop_number\" class=\"form-control stop-number\" value=\"' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '\"> <p style=\"display:none;\" class=\"modal-id\">' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '<\/p>',
		        	$('#locations-' + count + '-address1').val(),
		         	$('#locations-' + count + '-city').val(),
		        	$('#locations-' + count + '-state').val(),
		        	$('#locations-' + count + '-postal_code').val(),
		        	$('#locations-' + count + '-arrival_date').val(),
		        	'<a class=\"edit-modal\" href=\"#responsive-' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '\" data-toggle=\"modal\">Edit<\/a>/<a class=\"delete-row\" href=\"\">Delete<\/a>' ]
		        );
				
				$('.new-modal').prop('href', '#responsive-' + ($('.modal.fade').length + 1));

				

			}); 

			$( document ).on( "click", ".update-modal", function() {
				var modal_id = $(this).closest(".modal.fade").children("p").text();
				//alert($(this).closest(".form-control.stop-number").length);
				$('#sample_2').dataTable().fnUpdate( 
					['<input type=\"text\" id=\"locations-' + modal_id + '-stop_number\" class=\"form-control stop-number\" value=\"' + modal_id + '\"> <p style=\"display:none;\" class=\"modal-id\">' + modal_id + '<\/p>', 
					$('#locations-' + modal_id + '-address1').val(),
		         	$('#locations-' + modal_id + '-city').val(),
		        	$('#locations-' + modal_id + '-state').val(),
		        	$('#locations-' + modal_id + '-postal_code').val(),
		        	$('#locations-' + modal_id + '-arrival_date').val(),
		        	'<a class=\"edit-modal\" href=\"#responsive-' + modal_id + '\" data-toggle=\"modal\">Edit<\/a>/<a class=\"delete-row\" href=\"\">Delete<\/a>'
		        	], $('td').filter(function() {
							return $(this).children("p").text() == modal_id;
						}).closest('tr').index());
			}); 

			$( document).on("change", ".location-type", function() {
				if ($(this).val() == "Pickup") {
					$('#pickup-' + $(this).attr("id").match(/\d+/)).css("display", "");
					$('#delivery-' + $(this).attr("id").match(/\d+/)).css("display", "none");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-delivery_weight').val("");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-delivery_notes').val("");
				} else if ($(this).val() == "Drop Off") {
					$('#pickup-' + $(this).attr("id").match(/\d+/)).css("display", "none");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-pickup_weight').val("");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-pickup_notes').val("");
					$('#delivery-' + $(this).attr("id").match(/\d+/)).css("display", "");
				} else if ($(this).val() == "Both") {
					$('#pickup-' + $(this).attr("id").match(/\d+/)).css("display", "");
					$('#delivery-' + $(this).attr("id").match(/\d+/)).css("display", "");
				} else {
					$('#pickup-' + $(this).attr("id").match(/\d+/)).css("display", "none");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-pickup_weight').val("");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-pickup_notes').val("");
					$('#delivery-' + $(this).attr("id").match(/\d+/)).css("display", "none");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-delivery_weight').val("");
					$('#locations-' + $(this).attr("id").match(/\d+/) +'-delivery_notes').val("");
				}
			});

			function create_modal(index){
			    
			    var modal = '<div id=\"responsive-' + index + '\" class=\"modal fade\" tabindex=\"-1\" data-width=\"840\" style=\"display: none;\">' +
			   				' <p style=\"display:none;\" class=\"modal-id\">' + index + '<\/p>' + 
							'	<div class=\"modal-header\" id=\"modal-header\">' +
							'		<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-none=\"true\">' +
							'			&times;' +
							'		<\/button>' +
							'		<h4 class=\"modal-title\">Add Location<\/h4>' +
							'	<\/div>' +
							'	<div class=\"modal-body\">' +
							'		<div class=\"row\">' +
							'			<div class=\"panel panel-default\">' +
							'				<div class=\"panel-heading\">' +
							'					<i class=\"fa fa-external-link-square\"><\/i>' +
							'					Location - ' + index + '' +
							'				<\/div>' +
							'				<div class=\"panel-body\">' +
							'					<div class=\"row\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>General<\/h4>' +
							'							<hr>' +
							'							<input type=\"none\" id=\"locations-' + index + '-retired\" name=\"locations-' + index + '-retired\" class=\"form-control\" value=\"'+index+'\">' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Type <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<select id=\"locations-' + index + '-stop_type\" name=\"locations-' + index + '-stop_type\" class=\"form-control location-type\" value=\"\">' +
							'										<option value=\"<none selected>\"><\/option>' +
							'										<option value=\"Pickup\">Pickup<\/option>' +
							'										<option value=\"Drop Off\">Drop Off<\/option>' +
							'										<option value=\"Both\">Both<\/option>' +
							'									<\/select>' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Address <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-address1\" name=\"locations-' + index + '-address1\" class=\"form-control\" value=\"\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									City <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-city\" name=\"locations-' + index + '-city\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									State <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-state\" name=\"locations-' + index + '-state\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Zip Code <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-postal_code\" name=\"locations-' + index + '-postal_code\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Arrival Date <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-arrival_date\" name=\"locations-' + index + '-arrival_date\" data-date-format=\"mm-dd-yyyy\" data-date-viewmode=\"years\" class=\"form-control date-picker\">' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'					<div class=\"row\"><hr><\/div>' +
							'					<div class=\"row\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>Contact<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Name <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-contact_name\" name=\"locations-' + index + '-contact_name\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Phone <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-contact_phone\" name=\"locations-' + index + '-contact_phone\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'					<div class=\"row\"><hr><\/div>' +
							'					<div class=\"row\" id=\"pickup-' + index + '\" style=\"display:none;\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>Pickup<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Weight <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-pickup_weight\" name=\"locations-' + index + '-pickup_weight\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Notes' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<textarea class=\"autosize form-control\" id=\"locations-' + index + '-pickup_notes\" name=\"locations-' + index + '-pickup_notes\" style=\"overflow: none; word-wrap: break-word; resize: horizontal; height: 69px;\"><\/textarea>' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'					<div class=\"row\" id=\"delivery-' + index + '\" style=\"display:none;\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>Delivery<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Weight <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-delivery_weight\" name=\"locations-' + index + '-delivery_weight\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Notes' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<textarea class=\"autosize form-control\" id=\"locations-' + index + '-delivery_notes\" name=\"locations-' + index + '-pickup_notes\" style=\"overflow: none; word-wrap: break-word; resize: horizontal; height: 69px;\"><\/textarea>' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'				<\/div>' +
							'			<\/div>' +
							'		<\/div>' +
							'	<\/div>' +
							'	<div class=\"modal-footer\">' +
							'   <input type=\"none\" id=\"locations-' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '-stop_number\" name=\"locations-' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '-stop_number\" class=\"form-control stop-number\" value=\"' + ($('#sample_2').dataTable().fnSettings().aoData.length + 1) + '\">' +
							'		<button type=\"button\" data-dismiss=\"modal\" class=\"btn btn-light-grey\">' +
							'			Close' +
							'		<\/button>' +
							'		<button type=\"button\" data-dismiss=\"modal\" class=\"btn btn-blue save-modal\">' +
							'			Add' +
							'		<\/button>' +
							'	<\/div>' +
							'<\/div>'
			    $("#form-container").append(modal);
			}
		
		


		</script>

		
				{% endblock %}
