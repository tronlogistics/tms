{% extends "layout_map.html" %}

{% block content %}
	<div class="row-fluid">
	    <div class="col-sm-12">
	    	<div class="row">
	    		<div class="col-sm-6">
	        		<div class="panel panel-default">
	            		<div class="panel-heading">
	                		Map
	            		</div>
	            		<div class="panel-body">
		                	<div id="map-canvas" style="height: 400px; margin: 0; padding: 0;"></div>
		                </div>
	                	<table class="table table-striped table-hover table-condensed" id="sample-table-1">
		                    <thead>
		                        <tr>
		                            <th>Stop #</th>
		                            <th>Address</th>
		                            <th>Arrival Date</th>
		                            <th>Status</th>
		                            <th>Actions</th>
		                            <!--<th>Status</th>-->
		                        </tr>
		                    </thead>
		                    <tbody>
		                    	{% if load.lane.locations.count() < 1 %}
		                    		<tr>
		                    			<td colspan="5" class="text-center">No Location Information Saved</td>
		                    		</tr>
		                    	{% else %}
		                        	{% for location in locations|sort(attribute="stop_number") %}
			                            <tr>
			                            	<!--<td><a href="#responsive-{{ loop.index }}" data-toggle="modal">View</a></td>-->
			                            	<td>{{ loop.index }}</td>
			                            	<td>{{ location.address.address1 }}<br />{{ location.address.city }}, {{ location.address.state }} {{ location.address.postal_code }}</td>
			                            	<td>{{ location.arrival_date }}</td>
			                            	<td>{{ location.status }}</td>
			                            	<td><a href="{{ url_for('.edit_location', load_id=load.id, location_id=location.id) }}">Edit</a>&nbsp;&nbsp;&nbsp;<a href="{{ url_for('.delete_location', load_id=load.id, location_id=location.id) }}">Delete</a>
			                            	<!--<td>
			                            		<input type="hidden" id="location_status-{{ loop.index }}-location_id" name="location_status-{{ loop.index }}-location_id" class="form-control" value="{{ location.id }}">

			                            		<select id="location_status-{{ loop.index }}-status" name="location_status-{{ loop.index }}-status" class="form-control location-type" value="">
			                            			{% if location.status is none %}
														<option value="Pending Arrival">Pending Arrival</option>
													{% else %}
														<option value="{{ location.status }}">{{ location.status }}</option>
													{% endif %}
													{% if location.status != "Arrived" %}
														<option value="Arrived">Arrived</option>
													{% endif %}
													{% if location.status != "Loaded" %}
														<option value="Loaded">Loaded</option>
													{% endif %}
													{% if location.status != "Departed" %}
														<option value="Departed">Departed</option>
													{% endif %}
												</select>
											</td>-->
			                            </tr>
			                        {% endfor %}
			                    {% endif %}
		                    </tbody>
		                </table>
	            	</div>
	         	</div>
	         	<div class="col-sm-6">
	         		<div class="row">
	         			<div class="col-sm-12">
			        		<div class="panel panel-default">
			            		<div class="panel-heading">
			                		Shipper
			            		</div>
			            		<table id="truck" class="table table-condensed">
									<tbody>
				           
					                    	<tr>
												<td><b>Name:</b></td>
												<td>{{ load.shipper.name }}</td>
											</tr>
											<tr>
												<td><b>Phone:</b></td>
												<td>{{ load.shipper.phone }}</td>
											</tr>
											<tr>
												<td><b>Email:</b></td>
												<td>{{ load.shipper.email }}</td>
											</tr>
					                </tbody>
								</table>
		                	</div>
		            	</div>
		            </div>
		            <div class="row">
		            	<div class="col-sm-12">
			        		<div class="panel panel-default">
			            		<div class="panel-heading">
			                		Broker
			            		</div>
			            		<table id="truck" class="table table-condensed">
									<tbody>
				           
					                    	<tr>
												<td><b>Name:</b></td>
												<td>{{ load.broker.name }}</td>
											</tr>
											<tr>
												<td><b>Phone:</b></td>
												<td>{{ load.broker.phone }}</td>
											</tr>
											<tr>
												<td><b>Email:</b></td>
												<td>{{ load.broker.email }}</td>
											</tr>
					                </tbody>
								</table>
		                	</div>
		            	</div>
		            </div>
		            {% if load.truck is not none %}
			            <div class="row">
			            	<div class="col-sm-12">
				        		<div class="panel panel-default">
				            		<div class="panel-heading">
				                		{% if user.is_carrier() %}
				                			Assigned Truck/Driver
				                		{% else %}
				                			Assigned Carrier
				                		{% endif %}
				            		</div>
				            		<table id="truck" class="table table-condensed">
										<tbody>
					               			{% if not user.is_carrier() %}
						                    	<tr>
													<td><b>Carrier:</b></td>
													<td>{{ load.carrier.company_name }}</td>
												</tr>
												<tr>
													<td><b>Carrier Fee:</b></td>
													<td>{{ load.carrier_cost }}</td>
												</tr>
						                    {% else %}
						                    	<tr>
													<td><b>Amount:</b></td>
													<td>{{ load.price }}</td>
												</tr>
					                		{% endif %}
						                	{% if load.truck is not none %}
							                    <tr>
													<td><b>Truck:</b></td>
													<td><a href="{{ url_for('trucks.view', truck_id=load.truck.id) }}">{{ load.truck.name }}</a></td>
												</tr>
												<tr>
													<td><b>Driver:</b></td>
													<td><a href="{{ url_for('drivers.view', driver_id=load.truck.driver.id) }}">{{ load.truck.driver.get_full_name() }}</a></td>
												</tr>
							                {% else %}
							                	<tr>
													<td><b>Truck:</b></td>
													<td>To be assigned</td>
												</tr>
							               	{% endif %}
						                </tbody>
									</table>
			                	</div>
			            	</div>
			            </div>
		        	{% else %}
		        		<div class="row">
							<div class="col-sm-12">
								<div class="panel panel-default">
				            		<div class="panel-heading">
				                		Trucks
				            		</div>
			            			<table class="table table-striped table-condensed">
			            				<thead>
			            					<tr>
			            						<th>Truck</th>
			            						<th>Driver</th>
			            						{% if not is_dispatch %}
			            							<th>Quote</th>
			            						{% endif %}
			            						<th>&nbsp</th>
			            					</tr>
			 							</thead>
			 							<tbody>
		 									{% if carriers|length == 0 %}
		 									<tr>
		 										<td colspan="3">There are no trucks available for this load</td>
		 									</tr>
		 									{% else %}
				 								{% for carrier in carriers %}
				 								<tr class="odd gradeX">
				 									<td><a href="{{ url_for('trucks.view', truck_id=carrier.id) }}">{{ carrier.name }}</a></td>
				 									<td>
				 											{% if carrier.driver is none %}
				 												Unassigned
				 											{% else %}
				 												<a href="{{ url_for('drivers.view', driver_id=carrier.driver.id) }}">{{ carrier.driver.get_full_name() }}</a>
				 											{% endif %}
				 									</td>
				 									{% if not is_dispatch %}
				 										<td>{{ bid.value }}</td>
				 									{% endif %}
				 									
				 									<td>
				 										{% if is_dispatch and load.truck is none %}
			       			 								<a href="{{ url_for('loads.assign', load_id=load.id, assign_id=carrier.id)}}" onclick="return confirm("Assign this carrier to this load?")" class="btn btn-success btn-mini success">Assign</a>
			       			 							{% endif %}
			                                        </td>
				 								</tr>
				 								{% endfor %}
				 							{% endif %}
			 							</tbody>
			            			</table>
				            	</div>
				         	</div>
				        </div>
	         		{% endif %}
	            </div>
		    </div>

	    </div> 

<script>
function ping_driver(truckID) {
    $.post('/trucks/ping/'+truckID)
	.done(function(translated) {
       	alert(translated['message']);
    }).fail(function() {
        alert('failed');
    });
}
</script>


{#<script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.2.min.js"></script>#}
  {#<script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>#}


{% endblock %}