{% extends "layout_map.html" %}

{% block content %}




<div class="container-fluid" id="container">
	<div class="row-fluid">
		<div class="box">
			<div class="box-title">
				Actions: &nbsp;&nbsp;<a href="{{ url_for('load.edit', load_id=load.id) }}" class="btn btn-primary">Edit</a>
			</div>
		</div>
	</div>
	<div class="row-fluid">
	    <div class="span12">
	    	<div class="row-fluid">
	    		<div class="span6">
	        		<div class="box">
	            		<div class="box-title">
	                		Map
	            		</div>
	            		<div class="box-content nopadding">
		                	<div id="map-canvas" style="height: 400px; margin: 0; padding: 0;"></div>
	                	</div>
	            	</div>
	         	</div>
	         		{% if user.is_carrier() and load.broker != user %}
	         		<div class="span6">
		        		<div class="box">
		        			<div class="box-title">
		                		Bid
		            		</div>
		            		<div class="box-content nopadding">
		            				{% if most_recent_bid is not none %}
		            					<div class="form-horizontal">
			                    			<div class="control-group">
												<label class="control-label">Bid</label>
					                        	<div class="controls">
					                           		${{ most_recent_bid.value }}
					                        	</div>
					                        	<label class="control-label">Status</label>
					                        	<div class="controls">
					                           		{% if load.status == "Pending Truck Assignment" or load.status == "Assigned" %}
					                        			Accepted
					                        		{% else %}
					                        			Pending Acceptance
					                        		{% endif %}
					                        	</div>
											</div>
										</div>
		            				{% else %}
			            				<form name="edit" action="{{ url_for('load.bid', load_id=load.id, company_name=load.broker.company_name) }}" method="post" class="form-horizontal">
			            					{{ form.hidden_tag() }}
			            					<div class="form-horizontal">
				                    			<div class="control-group">
													<label class="control-label">Bid</label>
						                        	<div class="controls">
						                           		${{ form.value(size=8) }} 
						                           		<input type="submit" class="btn btn-success btn-mini success" value="Place Bid" /> <a href="{{ url_for('load.reject', load_id=load.id, company_name=load.broker.company_name) }}" class="btn btn-danger btn-mini danger">Reject Load</a>
				                                        {% for error in form.value.errors %}
						 									<span style="color: red;">[{{ error }}]</span>
			          									{% endfor %}
						                        	</div>
												</div>
											</div>
										</form>
									{% endif %}
								</div>
							</div>
						</div>
					{% endif %}
	         		{% if load.status == "Assigned" or load.status == "Complete" or load.status == "Pending Truck Assignment"  %}
	         			<div class="span6">
			        		<div class="box">
			            		<div class="box-title">
			                		{% if user.is_carrier() %}
			                			Assigned Truck/Driver
			                		{% else %}
			                			Assigned Carrier
			                		{% endif %}
			            		</div>
			            		<div class="box-content nopadding">

				               		<div class="form-horizontal">
				               			{% if not user.is_carrier() %}
					                   		<div class="control-group">
					                       		<label class="control-label">Carrier</label>
					                       		<div class="controls">
					                       			<p>{{ load.carrier.company_name }}</p>
					                       		</div>
					                   		</div>
					                    	<div class="control-group">
					                       		<label class="control-label">Carrier Fee</label>
					                       		<div class="controls">
					                       			<p>${{ load.carrier_cost }}</p>
					                      		</div>
					                    	</div>
					                    {% else %}
					                    	<div class="control-group">
					                       		<label class="control-label">Amount</label>
					                       		<div class="controls">
					                       			<p>${{ load.carrier_cost }}</p>
					                      		</div>
					                    	</div>
				                		{% endif %}
				                	
					                	{% if load.status == "Assigned" or load.status == "Complete" %}
						                	<div class="control-group">
					                        	<label class="control-label">Truck</label>
					                        	<div class="controls">
					                           		<p><a href="{{ url_for('carrier.view_truck', truck_id=load.assigned_driver.truck.id) }}">{{ load.assigned_driver.truck.name }}</a></p>
					                        	</div>
						                    </div>
						                    <div class="control-group">
					                        	<label class="control-label">Driver</label>
					                        	<div class="controls">
					                           		<p><a href="{{ url_for('carrier.view_driver', driver_id=load.assigned_driver.truck.id) }}">{{ load.assigned_driver.get_full_name() }}</a></p>
					                        	</div>
						                    </div>
						                {% else %}
						                	<div class="form-horizontal">
						                    	<div class="control-group">
						                       		<label class="control-label">Truck</label>
						                       		<div class="controls">
						                          			<p>To be assigned</p>
						                       		</div>
						                   		</div>
						                	</div> 
						               	{% endif %}
					               	</div>
				               </div>
		                	</div>
		            	</div>
					{% endif %}
					{% if (is_dispatch and load.status != "Assigned" and load.status != "Complete") or (not is_dispatch and load.status != "Pending Truck Assignment" and load.status != "Assigned" and load.status != "Complete") %}
						<div class="span6">
			        		{#<div class="box">
			        			<div class="box-title">
			                		Filter
			            		</div>
			            		<div class="box-content nopadding">
			       
										Radius from origin - 50, 100, 150, 200, 250
								</div>
							</div>#}
							<div class="box">
			            		<div class="box-title">
			                		Nearby Carriers
			            		</div>
			            		<div class="box-content nopadding">
			            			<table id="datatable" class="table table-striped table-bordered">
			            				<thead>
			            					<tr>
			            						<th>Icon #</th>
			            						<th>Name</th>
			            						{% if not is_dispatch %}
			            							<th>Quote</th>
			            						{% endif %}
			            						<th>&nbsp</th>
			            					</tr>
			 							</thead>
			 							<tbody>
			 								{% if not is_dispatch %}
			 									{% for bid in offered_bids %}
			 										<tr class="odd gradeX">
				 										<td>1</td>
				 										<td>{{ bid.offered_by.email }}</td>			
				 										<td>{{ bid.value }}</td>
				 										<td>
			       			 								<a href="{{ url_for('load.assign', load_id=load.id, assign_id=bid.offered_by.company_name)}}" onclick="return confirm("Assign this carrier to this load?")text" class="btn btn-success btn-mini success">Assign</a>
			                                        	</td>
				 									</tr>
			 									{% endfor %}
			 									{% for bid in requested_bids %}
			 										<tr class="odd gradeX">
				 										<td>1</td>
				 										<td>{{ bid.offered_to.email }}</td>
				 										<td></td>
				 										<td>
			       			 								Requested Bid
			                                        	</td>
				 									</tr>
			 									{% endfor %}
			 									{% for carrier in carriers %}
			 										<tr class="odd gradeX">
				 										<td>{{ carrier.company_name }}</td>
				 										<td><a href="{{ url_for('carrier.view', truck_id=carrier.id) }}">{{ carrier.company_name }}</a></td>
				 										<td></td>
				 										<td>
			       			 								<a href="{{ url_for('load.bid', load_id=load.id, company_name=carrier.company_name)}}" class="btn btn-success btn-mini success">Request Bid</a>
			                                        	</td>
				 									</tr>
				 								{% endfor %}
			 									{% for bid in rejected_bids %}
			 										<tr class="odd gradeX">
				 										<td>2</td>
				 										<td>{{ bid.offered_by.email }}</td>
				 										<td>N/a</td>
				 										<td>
			       			 								Rejected Bid
			                                        	</td>
				 									</tr>
			 									{% endfor %}
			 								{% else %}
				 								{% for carrier in carriers %}
				 								<tr class="odd gradeX">
				 									<td>{{ carrier.id }}</td>
				 									<td><a href="{{ url_for('carrier.view_truck', truck_id=carrier.id) }}">{{ carrier.name }}</a></td>
				 									{% if not is_dispatch %}
				 										<td>{{ bid.value }}</td>
				 									{% endif %}
				 									
				 									<td>
				 										{% if load.status == "Pending Truck Assignment" and is_dispatch %}
			       			 							<a href="{{ url_for('load.assign', load_id=load.id, assign_id=carrier.id)}}" onclick="return confirm("Assign this carrier to this load?")text" class="btn btn-success btn-mini success">Assign</a>
			       			 							{% endif %}
			                                        </td>
				 								</tr>
				 								{% endfor %}
				 							{% endif %}
			 							</tbody>
			            			</table>
			                	</div>
			            	</div>
			         	</div>
	         		{% endif %}
	        </div>
		    </div>
	        <div class="row-fluid">
	    		<div class="span12">
	        		<div class="box">
	            		<div class="box-title">
	                		Load Details
	            		</div>
	            		<div class="box-content nopadding">
		                	<div class="form-horizontal">
		                    	{#<div class="control-group">
		                        	<label class="control-label">Name</label>
		                        	<div class="controls">
		                           		{{ load.name }}
		                        	</div>
		                    	</div>#}
		                    	<div class="control-group">
		                        	<label class="control-label">Weight</label>
		                        	<div class="controls">
		                           		{{ load.load_detail.weight }}
		                        	</div>
		                    	</div>
		                    	<div class="control-group">
		                        	<label class="control-label">Length</label>
		                        	<div class="controls">
		                           		{{ load.load_detail.dim_length }}
		                        	</div>
		                    	</div>
		                    	<div class="control-group">
		                        	<label class="control-label">Width</label>
		                        	<div class="controls">
		                           		{{ load.load_detail.dim_width }}
		                        	</div>
		                    	</div>
		                    	<div class="control-group">
		                        	<label class="control-label">Height</label>
		                        	<div class="controls">
		                           		{{ load.load_detail.dim_height }}
		                        	</div>
		                    	</div>
		                    	<div class="control-group">
		                        	<label class="control-label">Number of pieces</label>
		                        	<div class="controls">
		                           		{{ load.load_detail.number_pieces }}
		                        	</div>
		                    	</div>
		                    </div>
	                	</div>
	            	</div>
	         	</div>         
	        </div>
	    </div> 
	</div>
</div>
<script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.2.min.js"></script>
  <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
<script>
$(function(){
    $("#datatable").dataTable();
  })
</script>


{% endblock %}