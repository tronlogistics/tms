{% extends "layout.html" %}

{% block content %}
<form name="create" action="" role="form" class="smart-wizard form-horizontal" id="form" method="post">
	{{ form.hidden_tag() }}
	<!-- start: PAGE CONTENT -->
	<div class="row" id="form-container">
		<div class="col-sm-12">
			<!-- start: FORM WIZARD PANEL -->
			<div id="wizard" class="swMain">
				<ul>
					<li>
						<a href="#step-1">
							<div class="stepNumber">
								1
							</div>
							<span class="stepDesc"> Step 1
								<br />
								<small>General Information</small> </span>
						</a>
					</li>
					<li>
						<a href="#step-2">
							<div class="stepNumber">
								2
							</div>
							<span class="stepDesc"> Step 2
								<br />
								<small>Lane(s)</small> </span>
						</a>
					</li>
				</ul>
				<div class="progress progress-striped active progress-sm">
					<div aria-valuemax="100" aria-valuemin="0" role="progressbar" class="progress-bar progress-bar-success step-bar">
						<span class="sr-only"> 0% Complete (success)</span>
					</div>
				</div>
				<div id="step-1">
					<h2 class="StepTitle">Step 1 Content</h2>
					<hr>
					<div class="row">
						<div class="col-sm-10">
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Load Type <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.load_type(class="form-control") }}
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Required Trailer <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.trailer_type(class="form-control") }}
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Total Miles <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.total_miles(class="form-control", placeholder="Total Miles") }}
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Cost <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.price(class="form-control", placeholder="Price") }}
								</div>
							</div>
						</div>
						{#<div class="col-sm-5">
							<div class="form-group">
								<label class="col-sm-3 control-label">
									# Pieces <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.number_pieces(class="form-control", placeholder="Number of Pieces") }}
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Over Dimensional? 
								</label>
								<div class="col-sm-7">
									{{ form.over_dimensional() }}
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Comments <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									{{ form.comments(class="form-control", placeholder="Number of Pieces") }}
								</div>
							</div>
						</div>#}
					</div>
					<hr>
					<div class="row">
						<div class="col-sm-10">
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Load Description
								</label>
								<div class="col-sm-7">
									{{ form.description(class="autosize form-control", style="overflow: hidden; word-wrap: break-word; resize: horizontal; height: 69px;") }}
								</div>
							</div>
						</div>
					</div>
					<hr>
					<div class="form-group">
						<div class="col-sm-3 col-sm-offset-7">
							<button class="btn btn-blue next-step btn-block">
								Next <i class="fa fa-arrow-circle-right"></i>
							</button>
						</div>
					</div>
				</div>
				<div id="step-2">
					<h2 class="StepTitle">Step 2 Content</h2>
					<div class="col-md-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								<i class="fa fa-external-link-square"></i>
								Locations
								<div class="panel-tools">
									<a class="btn btn-xs btn-link panel-collapse collapses" href="#"> </a>
									<a class="btn btn-xs btn-link panel-config" href="#panel-config" data-toggle="modal"> <i class="fa fa-wrench"></i> </a>
									<a class="btn btn-xs btn-link panel-refresh" href="#"> <i class="fa fa-refresh"></i> </a>
									<a class="btn btn-xs btn-link panel-expand" href="#"> <i class="fa fa-resize-full"></i> </a>
									<a class="btn btn-xs btn-link panel-close" href="#"> <i class="fa fa-times"></i> </a>
								</div>
							</div>
							<div class="panel-body">
								<div class="row">
									<div class="col-md-12 space20">
										<a href="#responsive-3" data-toggle="modal" class="new-modal btn btn-green">
													Add New <i class="fa fa-plus"></i>
												</a>
									</div>
								</div>
								<div class="table-responsive">
									<table class="table table-striped table-hover" id="sample_2">
										<thead>
											<tr>
												<th>Stop #</th>
												<th>Street Address</th>
												<th>City</th>
												<th>State</th>
												<th>Zip</th>
												<th>Pickup Weight</th>
												<th>Delivery Weight</th>
												<th>Arrival Date</th>
												{#<th>Arrival Time</th>#}
												<th>Edit/Delete</th>
											</tr>
										</thead>
										<tbody>
											{% for location in load.lane.locations %}

											<tr>
												<td>{{ location.stop_number }}</td>
												<td>{{ location.address.address1}}</td>
												<td>{{ location.address.city }}</td>
												<td>{{ location.address.state }}</td>
												<td>{{ location.address.postal_code }}</td>
												<td>{{ location.arrival_details[0].weight }}</td>
												<td>{{ location.arrival_details[1].weight }}</td>
												<td>{{ location.arrival_date.strftime('%m/%d/%Y') }}</td>
												<td><a class="edit-modal" href="#responsive-{{ location.stop_number }}" data-toggle="modal">Edit</a>/<a class="delete-row" href="">Delete</a></td>
											</tr>
											{% endfor %}
											<!--- Content created by table-data.js -->
										</tbody>
									</table>
								</div>
							</div>
						</div>

					</div>
					<hr>
					<div class="form-group">
						<div class="col-sm-2 col-sm-offset-3">
							<button class="btn btn-light-grey back-step btn-block">
								<i class="fa fa-circle-arrow-left"></i> Back
							</button>
						</div>
						<div class="col-sm-2 col-sm-offset-3">
							<button type="submit" class="btn btn-success btn-block">
								Finish <i class="fa fa-arrow-circle-right"></i>
							</button>
						</div>
					</div>
				</div>
			</div>							
			<!-- end: FORM WIZARD PANEL -->
		</div>
	{% for location in load.lane.locations %}
		<div id="responsive-{{ location.stop_number }}" class="modal fade" tabindex="-1" data-width="840" style="display: none;"> 
			<div class="modal-header"> 
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true"> 
					&times; 
				</button> 
				<h4 class="modal-title">Add Location</h4> 
			</div> 
			<div class="modal-body"> 
				<div class="row"> 
					<div class="panel panel-default"> 
						<div class="panel-heading"> 
							<i class="fa fa-external-link-square"></i> 
							Location - {{ location.stop_number }} 

						</div> 
						<div class="panel-body"> 
							<div class="row"> 
								<div class="col-md-12"> 
									<h4>General</h4> 
									<hr> 
									<input type="hidden" id="locations-{{ location.stop_number }}-stop_number" name="locations-{{ location.stop_number }}-stop_number" class="form-control" value="{{ location.stop_number }}"> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Address <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-address1" name="locations-{{ location.stop_number }}-address1" class="form-control" value="{{ location.address.address1 }}"> 
										</div> 
									</div> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											City <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-city" name="locations-{{ location.stop_number }}-city" class="form-control" value="{{ location.address.city }}"> 
										</div> 
									</div> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											State <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-state" name="locations-{{ location.stop_number }}-state" class="form-control" value="{{ location.address.state }}"> 
										</div> 
									</div> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Zip Code <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-postal_code" name="locations-{{ location.stop_number }}-postal_code" class="form-control" value="{{ location.address.postal_code }}"> 
										</div> 
									</div> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Arrival Date <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-arrival_date" name="locations-{{ location.stop_number }}-arrival_date" data-date-format="dd-mm-yyyy" data-date-viewmode="years" class="form-control date-picker" value="{{ location.arrival_date }}"> 
										</div> 
									</div> 
								</div> 
							</div> 
							<div class="row"><hr></div> 
							<div class="row"> 
								<div class="col-md-12"> 
									<h4>Receiver</h4> 
									<hr> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Name <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-contact_name" name="locations-{{ location.stop_number }}-contact_name" class="form-control"> 
										</div> 
									</div> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Phone <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-contact_phone" name="locations-{{ location.stop_number }}-contact_phone" class="form-control"> 
										</div> 
									</div> 
								</div> 
							</div> 
							<div class="row"><hr></div> 
							<div class="row"> 
								<div class="col-md-6"> 
									<h4>Pickup</h4> 
									<hr> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Weight <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-pickup_weight" name="locations-{{ location.stop_number }}-pickup_weight" class="form-control" value="{{ location.arrival_details[0].weight }}"> 
										</div> 
									</div> 
								</div> 
								<div class="col-md-6"> 
									<h4>Delivery</h4> 
									<hr> 
									<div class="form-group"> 
										<label class="col-sm-3 control-label"> 
											Weight <span class="symbol required"></span> 
										</label> 
										<div class="col-sm-7"> 
											<input type="text" id="locations-{{ location.stop_number }}-delivery_weight" name="locations-{{ location.stop_number }}-delivery_weight" class="form-control" value="{{ location.arrival_details[1].weight }}"> 
										</div> 
									</div> 
								</div> 
							</div> 
						</div> 
					</div> 
				</div> 
			</div> 
			<div class="modal-footer"> 
				<button type="button" data-dismiss="modal" class="btn btn-light-grey"> 
					Close 
				</button> 
				<button type="button" data-dismiss="modal" class="btn btn-blue save-modal"> 
					Add 
				</button> 
			</div> 
		</div>
	{% endfor %}
	</div>
</form>

{#<div id="responsive-1" class="modal fade" tabindex="-1" data-width="760" style="display: none;">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
			&times;
		</button>
		<h4 class="modal-title">Add Location</h4>
	</div>
	<div class="modal-body">
		<div class="row">
			<div class="panel panel-default">
				<div class="panel-heading">
					<i class="fa fa-external-link-square"></i>
					Location
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-md-12">
							<h4>General</h4>
							<hr>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Address <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									City <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									State <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Zip Code <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
						</div>
					</div>
					<div class="row"><hr></div>
					<div class="row">
						<div class="col-md-12">
							<h4>Receiver</h4>
							<hr>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Name <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Phone <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
						</div>
					</div>
					<div class="row"><hr></div>
					<div class="row">
						<div class="col-md-6">
							<h4>Pickup</h4>
							<hr>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Weight <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<h4>Delivery</h4>
							<hr>
							<div class="form-group">
								<label class="col-sm-3 control-label">
									Weight <span class="symbol required"></span>
								</label>
								<div class="col-sm-7">
									<input type="text" class="form-control">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" data-dismiss="modal" class="btn btn-light-grey">
			Close
		</button>
		<button type="button" data-dismiss="modal" class="btn btn-blue save-modal">
			Add
		</button>
	</div>
</div>#}
		<!-- end: RIGHT SIDEBAR -->
{% include "partials/main_javascripts.html" %}
		<!-- start: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
		<script src="{{ static('backend/plugins/jquery-inputlimiter/jquery.inputlimiter.1.3.1.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery-validation/dist/jquery.validate.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jQuery-Smart-Wizard/js/jquery.smartWizard.js') }}"></script>
		<script src="{{ static('backend/js/form-wizard.js') }}"></script>
		<script src="{{ static('backend/plugins/autosize/jquery.autosize.min.js') }}"></script>
		<script src="{{ static('backend/plugins/select2/select2.min.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery.maskedinput/src/jquery.maskedinput.js') }}"></script>
		<script src="{{ static('backend/plugins/jquery-maskmoney/jquery.maskMoney.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-modal/js/bootstrap-modal.js') }}"></script>
		<script src="{{ static('backend/plugins/bootstrap-modal/js/bootstrap-modalmanager.js') }}"></script>
		<script src="{{ static('backend/js/ui-modals.js') }}"></script>
		
		<script>
			$(document).ready(function(){
			    $(".new-modal").click(function(){
			    	create_modal($('#sample_2').dataTable().fnSettings().aoData.length + 1);  
			    }); 	
			    $('#sample_2').on('click', '.delete-row', function(e) {
					modal_id = $(this).closest('tr').children('td:eq(0)').text();
					alert(modal_id);
					alert($('.modal.fade').length);
					$(this).closest('tr').remove();
					$('#responsive-'+model_id).children('div').remove();
					//alert(table.row( this ).data());
				});
				$('.edit_modal').on('click', '.edit-modal', function(e) {
					modal_id = $(this).closest('tr').children('td:eq(0)').text();
					alert(modal_id);
					alert($('.modal.fade').length);
					$(this).closest('tr').remove();
					$('#responsive-'+model_id).children('.save-modal').text("Save");
					//alert(table.row( this ).data());
				});
			});

			$( document ).on( "focus", "input.date-picker", function() {
				$('.date-picker').datepicker({
			            autoclose: true,
			            format: "mm/dd/yyyy",
						minDate: 0
			        });
			});

			$( document ).on( "click", ".save-modal", function() {
				var count = $('#sample_2').dataTable().fnSettings().aoData.length + 1;
				$('#sample_2').dataTable().fnAddData( [
		         	count,
		        	$('#locations-' + count + '-address1').val(),
		         	$('#locations-' + count + '-city').val(),
		        	$('#locations-' + count + '-state').val(),
		        	$('#locations-' + count + '-postal_code').val(),
		        	$('#locations-' + count + '-pickup_weight').val(),
		        	$('#locations-' + count + '-delivery_weight').val(),
		        	$('#locations-' + count + '-arrival_date').val(),
		        	"<a class=\"delete-row\" href=\"\">Delete<\/a>" ]
		        );
				
				$('.new-modal').prop('href', '#responsive-' + (count + 1));

			}); 

			function create_modal(index){
			    
			    var modal = '<div id=\"responsive-' + index + '\" class=\"modal fade\" tabindex=\"-1\" data-width=\"840\" style=\"display: none;\">' +
							'	<div class=\"modal-header\" id=\"modal-header\">' +
							'		<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">' +
							'			&times;' +
							'		<\/button>' +
							'		<h4 class=\"modal-title\">Add Location<\/h4>' +
							'	<\/div>' +
							'	<div class=\"modal-body\">' +
							'		<div class=\"row\">' +
							'			<div class=\"panel panel-default\">' +
							'				<div class=\"panel-heading\">' +
							'					<i class=\"fa fa-external-link-square\"><\/i>' +
							'					Location - ' + index + '' +
							'				<\/div>' +
							'				<div class=\"panel-body\">' +
							'					<div class=\"row\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>General<\/h4>' +
							'							<hr>' +
							'							<input type="hidden" id="locations-' + index + '-stop_number" name="locations-' + index + '-stop_number" class="form-control" value="' + index + '">' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Address <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-address1\" name=\"locations-' + index + '-address1\" class=\"form-control\" value=\"\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									City <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-city\" name=\"locations-' + index + '-city\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									State <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-state\" name=\"locations-' + index + '-state\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Zip Code <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-postal_code\" name=\"locations-' + index + '-postal_code\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Arrival Date <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-arrival_date\" name=\"locations-' + index + '-arrival_date\" data-date-format=\"dd-mm-yyyy\" data-date-viewmode=\"years\" class=\"form-control date-picker\">' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'					<div class=\"row\"><hr><\/div>' +
							'					<div class=\"row\">' +
							'						<div class=\"col-md-12\">' +
							'							<h4>Receiver<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Name <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-contact_name\" name=\"locations-' + index + '-contact_name\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Phone <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-contact_phone\" name=\"locations-' + index + '-contact_phone\" class=\"form-control\"\>' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'					<div class=\"row\"><hr><\/div>' +
							'					<div class=\"row\">' +
							'						<div class=\"col-md-6\">' +
							'							<h4>Pickup<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Weight <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-pickup_weight\" name=\"locations-' + index + '-pickup_weight\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'						<div class=\"col-md-6\">' +
							'							<h4>Delivery<\/h4>' +
							'							<hr>' +
							'							<div class=\"form-group\">' +
							'								<label class=\"col-sm-3 control-label\">' +
							'									Weight <span class=\"symbol required\"><\/span>' +
							'								<\/label>' +
							'								<div class=\"col-sm-7\">' +
							'									<input type=\"text\" id=\"locations-' + index + '-delivery_weight\" name=\"locations-' + index + '-delivery_weight\" class=\"form-control\">' +
							'								<\/div>' +
							'							<\/div>' +
							'						<\/div>' +
							'					<\/div>' +
							'				<\/div>' +
							'			<\/div>' +
							'		<\/div>' +
							'	<\/div>' +
							'	<div class=\"modal-footer\">' +
							'		<button type=\"button\" data-dismiss=\"modal\" class=\"btn btn-light-grey\">' +
							'			Close' +
							'		<\/button>' +
							'		<button type=\"button\" data-dismiss=\"modal\" class=\"btn btn-blue save-modal\">' +
							'			Add' +
							'		<\/button>' +
							'	<\/div>' +
							'<\/div>'
			    $("#form-container").append(modal);
			}
		
		


		</script>

		
				{% endblock %}
